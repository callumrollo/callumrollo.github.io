
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="index, follow" />

  <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro|Source+Sans+Pro:300,400,400i,700" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="https://callumrollo.github.io/theme/stylesheet/style.min.css">


    <link id="pygments-light-theme" rel="stylesheet" type="text/css"
          href="https://callumrollo.github.io/theme/pygments/monokai.min.css">


  <link rel="stylesheet" type="text/css" href="https://callumrollo.github.io/theme/font-awesome/css/fontawesome.css">
  <link rel="stylesheet" type="text/css" href="https://callumrollo.github.io/theme/font-awesome/css/brands.css">
  <link rel="stylesheet" type="text/css" href="https://callumrollo.github.io/theme/font-awesome/css/solid.css">


    <link href="https://callumrollo.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Callum Rollo Atom">


    <link rel="shortcut icon" href="https://callumrollo.github.io/images/favicon.ico" type="image/x-icon">
    <link rel="icon" href="https://callumrollo.github.io/images/favicon.ico" type="image/x-icon">


    <!-- Chrome, Firefox OS and Opera -->
    <meta name="theme-color" content="#333333">
    <!-- Windows Phone -->
    <meta name="msapplication-navbutton-color" content="#333333">
    <!-- iOS Safari -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Microsoft EDGE -->
    <meta name="msapplication-TileColor" content="#333333">

<meta name="author" content="Callum Rollo" />
<meta name="description" content="Excerpts from my .bashrc and shell scripts" />
<meta name="keywords" content="linux, bash, software, optimise">


<meta property="og:site_name" content="Callum Rollo"/>
<meta property="og:title" content="Shell games"/>
<meta property="og:description" content="Excerpts from my .bashrc and shell scripts"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="https://callumrollo.github.io/bash.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2020-10-02 18:20:00+01:00"/>
<meta property="article:modified_time" content="2020-10-26 10:50:00+00:00"/>
<meta property="article:author" content="https://callumrollo.github.io/author/callum-rollo.html">
<meta property="article:section" content="FOSS"/>
<meta property="article:tag" content="linux"/>
<meta property="article:tag" content="bash"/>
<meta property="article:tag" content="software"/>
<meta property="article:tag" content="optimise"/>
<meta property="og:image" content="https://callumrollo.github.io/images/mug.jpg">

  <title>Callum Rollo &ndash; Shell games</title>

</head>
<body class="light-theme">
  <aside>
    <div>
      <a href="https://callumrollo.github.io">
        <img src="https://callumrollo.github.io/images/mug.jpg" alt="Callum Rollo" title="Callum Rollo">
      </a>

      <h1>
        <a href="https://callumrollo.github.io">Callum Rollo</a>
      </h1>

<p>Throwing stuff in the ocean, but in a good way</p>

      <nav>
        <ul class="list">


              <li>
                <a target="_self"
                   href="https://callumrollo.github.io/pages/aboutme.html#aboutme">
                  About
                </a>
              </li>
              <li>
                <a target="_self"
                   href="https://callumrollo.github.io/pages/pay.html#pay">
                  My income
                </a>
              </li>
              <li>
                <a target="_self"
                   href="https://callumrollo.github.io/pages/teaching.html#teaching">
                  Teaching
                </a>
              </li>
              <li>
                <a target="_self"
                   href="https://callumrollo.github.io/pages/toolbox.html#toolbox">
                  Toolbox
                </a>
              </li>

        </ul>
      </nav>

      <ul class="social">
          <li>
            <a  class="sc-twitter" href="https://twitter.com/callum_rollo" target="_blank">
              <i class="fab fa-twitter"></i>
            </a>
          </li>
          <li>
            <a  class="sc-github" href="https://github.com/callumrollo" target="_blank">
              <i class="fab fa-github"></i>
            </a>
          </li>
      </ul>
    </div>

  </aside>
  <main>

    <nav>
      <a href="https://callumrollo.github.io">Home</a>

      <a href="/categories.html">Categories</a>
      <a href="/tags.html">Tags</a>

      <a href="https://callumrollo.github.io/feeds/all.atom.xml">Atom</a>

    </nav>

<article class="single">
  <header>
      
    <h1 id="bash">Shell games</h1>
    <p>
      Posted on Fri 02 October 2020 in <a href="https://callumrollo.github.io/category/foss.html">FOSS</a>

    </p>
  </header>


  <div>
    <h3>First off, what's a shell?</h3>
<p>The shell is how you, the mighty keyboard warrior, exert control over the awe-inspiring power of your <a href="https://www.youtube.com/watch?v=SpLRTAGa6bU">unix system</a>*.  Here I have collected some of my favourite one liners, aliases and shell scripts that I use to reduce repetitive typing, quickly analyse data, improve my writing, and more.</p>
<p>*If you're not already on some flavour of unix, check out <a href="http://matt.might.net/articles/basic-unix/">this guide</a> to get up to speed. It's way more fun than you might think, I promise.</p>
<p>For the purpose of this article the terms <strong>command line/shell/bash</strong> all refer to the same thing. Namely, that little black box you summon with ctrl + alt + T that makes you feel like a badass 90s cyberpunk about to hack the mainframe. Mine looks like this</p>
<p><img alt="Default terminal" src="../images/terminal.png"></p>
<p>Yours may differ in appearance, but as long as typing <code>ls</code> in it and hitting <code>enter</code> returns a list of directory contents, you should be good to go. Check out the link to <a href="http://matt.might.net/articles/basic-unix/">Matt Might's page</a> above for a nice intro to the shell.</p>
<h3>Some terms</h3>
<p>A <strong>one liner</strong> is a command that is one line long.</p>
<p>An <strong>alias</strong> is a short name you give to a longer command, like a nickname for your favourite code snippets. You can make one right now like this:</p>
<p><img alt="terminal alias" src="../images/terminal1.png"></p>
<p>Now your coputer can cheerfully greet you with the time of day in 4 keystrokes, neat huh?</p>
<p>A <strong>shell script</strong> is a series of instructions to be executed by your shell. This can range from a one liner, to sprawling programs. The advantage of writing shell scripts rather than, say Python scripts, is that any *nix system you use will have a shell and some core utilities. No need to install dependencies. For this reason shell scripts are <em>portable</em>, never leave the house without them! (If when you read this we are still experiencing a global pandemic, maybe don't leave the house at all if you can avoid it).</p>
<p>Now we've covered the terminology, on to the good stuff.</p>
<h3>My favourite aliases</h3>
<p>Some of these are original thoughts, many are adapted from examples I've found in various corners of the internet. Using these functions can boost your productivity, increase your net worth and make you more significantly more attractive [<a href="https://xkcd.com/285/">1</a>][<a href="https://xkcd.com/462">2</a>].</p>
<ul>
<li><code>..='cd ..'</code></li>
<li><code>please='sudo'</code></li>
<li><code>duh='du -h --max-depth=1'</code></li>
<li><code>gcb='git checkout -b'</code> and a whole lot of other git shortcuts</li>
<li><code>gdiff=" git diff --word-diff"</code> check what changes you have staged in a file</li>
<li><code>hpc='ssh -XY username@uni.hpc.server</code> access my uni hpc login node. I have many other aliases for quick remote access. Pro-tip: if you <a href="https://www.ssh.com/ssh/copy-id">set up ssh access keys</a> with <code>ssh-copy-id</code> you won't even need to enter a password</li>
<li><code>nb='jupyter notebook'</code></li>
<li><code>space='du -hS | sort -n -r |more'</code> to find what's using most space in a directory</li>
<li><code>wet='curl http://v2.wttr.in/Norwich'</code> why visit a weather site when you can find out form the command line why it's not worth leaving the house today?</li>
<li><code>aliasg='alias | grep'</code> for when I forget what I called my aliases</li>
<li><code>histg=history | grep</code> as above for command history</li>
<li><code>set -o vi</code> vim keybindings in shell. <strong>Only use if you love vim</strong>. emacs users can try <a href="https://youtu.be/dQw4w9WgXcQ?t=43">this</a> instead.</li>
</ul>
<p>You can create an alias straight from the terminal as I did with <code>gday</code></p>
<p><code>alias please='sudo'</code></p>
<p>Note the quote marks and lack of spaces round the <code>=</code>, these are not  optional.</p>
<p>Aliases created in such a way will only last through your terminal session. To persist aliases, they must be copied into your shell's <code>rc</code> file. This will be located in your home directory and typically hidden. For me it is <code>/home/callum/.zshrc</code>. Simply copy the aliases to the end of your <code>rc</code> file.</p>
<p>You can also set up slightly more complicated commands in the <code>rc</code> file like so</p>
<div class="highlight"><pre><span></span><code>mcd <span class="o">()</span> <span class="o">{</span>
    mkdir -p <span class="nv">$1</span>
    <span class="nb">cd</span> <span class="nv">$1</span>
<span class="o">}</span>
</code></pre></div>

<p>This command makes a directory then moves you into it. Try out <code>mcd test</code> then <code>pwd</code> to check where you are.</p>
<div class="highlight"><pre><span></span><code>com <span class="o">()</span> <span class="o">{</span>
    git add -A
    git commit -m <span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>
    git push
<span class="o">}</span>
</code></pre></div>

<p>This will add all files to the staging area, set a commit message of your choice and push upstream. Usage: <code>com "never push to master on Friday my dudes"</code></p>
<p>If you can't think of a useful git commit message, fear not <a href="https://github.com/lwe/whatthecommit">whatthecommit</a> has you covered. Try out my favourite alias <code>yolo</code></p>
<p><code>yolo='git add -A &amp;&amp; git commit -m "$(curl --silent --fail http://whatthecommit.com/index.txt)" &amp;&amp; git push'</code></p>
<p>After building up a suitably useful/infuriating series of commit messages, you can make a pretty git commit tree to admire them <a href="https://stackoverflow.com/questions/1838873/visualizing-branch-topology-in-git/34467298#34467298">(from this stackoverflow answer)</a></p>
<p><code>lg="git log --graph --abbrev-commit --decorate --format=format:'%C(bold blue)%h%C(reset) - %C(bold green)(%ar)%C(reset) %C(white)%s%C(reset) %C(dim white)- %an%C(reset)%C(auto)%d%C(reset)'"</code></p>
<p>Sample output, commit messages courtesy of whatthecommit:</p>
<p><img alt="terminal tree" src="../images/terminal2.png"></p>
<h3>Ugly but useful shell scripts</h3>
<p>These have saved me many hours of tedious manual tasks. Though I think some took more time to write than they have yet saved me...</p>
<p>Use <a href="https://ffmpeg.org/">ffmpeg</a> to apply fade in and out to a bunch of mp3 files</p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="k">for</span> i <span class="k">in</span> *.mp3<span class="p">;</span> <span class="k">do</span>
    ffmpeg -i <span class="s2">&quot;</span><span class="nv">$i</span><span class="s2">&quot;</span> -filter_complex <span class="s2">&quot;afade=d=0.5, areverse, afade=d=0.5, areverse&quot;</span> <span class="s2">&quot;`basename &quot;</span><span class="nv">$i</span><span class="s2">&quot; .mp3`f.mp3&quot;</span>
<span class="k">done</span>
</code></pre></div>

<p>For clipping a dataset of interest from a larger geographical dataset of shapefiles before plotting. Requires <a href="https://gdal.org/">gdal</a> library.</p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="c1"># </span>
ogr2ogr -f <span class="s2">&quot;ESRI Shapefile&quot;</span> hidf_land.shp /media/callum/storage/Documents/global_datasets/osm_land/land_polygons.shp -clipsrc <span class="nv">$1</span> <span class="nv">$2</span> <span class="nv">$3</span> <span class="nv">$4</span>
<span class="c1"># four numbers at end are western bound southern bound eastern bound and northern bound in degrees. Longitude is from -180 to 180</span>
</code></pre></div>

<p>Move your mouse every 30 seconds to prevent sleep mode. Inspired by <a href="https://xkcd.com/196/">xkcd</a></p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="k">while</span> <span class="o">[</span> <span class="m">1</span> <span class="o">]</span><span class="p">;</span> <span class="k">do</span>
  xdotool mousemove <span class="m">300</span> <span class="m">250</span>
  sleep <span class="m">30</span>
  xdotool mousemove <span class="m">300</span> <span class="m">850</span>
  sleep <span class="m">30</span>
<span class="k">done</span>
</code></pre></div>

<p>Use <a href="https://imagemagick.org/index.php">imagemagick</a> to crop and animate a bunch of figures into a gif. Written the night before a conference, don't judge me.</p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="k">for</span> i <span class="k">in</span> bar*.png
<span class="k">do</span>
<span class="nv">num</span><span class="o">=</span><span class="si">${</span><span class="nv">i</span><span class="p">: 3:</span><span class="nv">3</span><span class="si">}</span>

<span class="nv">filen</span><span class="o">=</span><span class="s2">&quot;clip</span><span class="nv">$num</span><span class="s2">.png&quot;</span>
<span class="nv">filen2</span><span class="o">=</span><span class="s2">&quot;crop</span><span class="nv">$num</span><span class="s2">.png&quot;</span>
convert <span class="nv">$i</span> -trim +repage <span class="nv">$filen</span>
convert -crop -800-300 <span class="nv">$filen</span> <span class="nv">$filen2</span>
<span class="k">done</span>
convert -delay <span class="m">20</span> -loop <span class="m">1</span> crop*.png animation.gif
<span class="nb">echo</span> foo
convert animation.gif  -trim +repage ani.gif
</code></pre></div>

<p>More imagemagick to make tight figures (remove all whitespace from edges)</p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

rsync --recursive --filter<span class="o">=</span><span class="s2">&quot;-! */&quot;</span> figures figures_crop

<span class="nb">shopt</span> -s extglob nullglob globstar
<span class="k">for</span> file <span class="k">in</span> figures/**/*.png
<span class="k">do</span>
    <span class="nb">echo</span> <span class="nv">$file</span>
    convert <span class="nv">$file</span> -trim +repage <span class="s2">&quot;figures_crop/</span><span class="nv">$file</span><span class="s2">&quot;</span>
<span class="k">done</span>
</code></pre></div>

<p>Get altimeter data from Seaglider log files</p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="c1"># if directory not passed, use working directory</span>
<span class="nv">_dir</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">1</span><span class="k">:-</span><span class="si">${</span><span class="nv">PWD</span><span class="si">}}</span><span class="s2">&quot;</span>

<span class="c1"># Die if given a bad directory path</span>
<span class="o">[</span> ! -d <span class="s2">&quot;</span><span class="nv">$_dir</span><span class="s2">&quot;</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="o">{</span> <span class="nb">echo</span> <span class="s2">&quot;Error: Directory </span><span class="nv">$_dir</span><span class="s2"> not found.&quot;</span><span class="p">;</span> <span class="nb">exit</span> <span class="m">2</span><span class="p">;</span> <span class="o">}</span>

&gt; alti.txt


<span class="nb">printf</span> <span class="s2">&quot;dive_no,altim_ping_depth,altim_bottom_ping,bottom_dist&quot;</span> &gt;&gt; alti.txt

<span class="k">for</span> i <span class="k">in</span> <span class="nv">$1</span>/*.log<span class="p">;</span> <span class="k">do</span>
    <span class="nb">echo</span> <span class="nv">$i</span>
    awk -F, <span class="s1">&#39;$1 == &quot;$DIVE&quot; {printf &quot;\n&quot; ; printf $2}&#39;</span> <span class="nv">$i</span> &gt;&gt; alti.txt
    awk -F, <span class="s1">&#39;$1 == &quot;$ALTIM_PING_DEPTH&quot; {$2=&quot;,&quot;$2; printf $2}&#39;</span> <span class="nv">$i</span> &gt;&gt; alti.txt
    awk -F, <span class="s1">&#39;$1 == &quot;$ALTIM_BOTTOM_PING&quot; {$2=&quot;,&quot;$2&quot;,&quot;; printf $2 $3}&#39;</span> <span class="nv">$i</span> &gt;&gt; alti.txt
<span class="k">done</span>
</code></pre></div>

<p>Get voltage minima from Seaglider logs</p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="c1"># if directory not passed, use working directory</span>
<span class="nv">_dir</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">1</span><span class="k">:-</span><span class="si">${</span><span class="nv">PWD</span><span class="si">}}</span><span class="s2">&quot;</span>

<span class="c1"># Die if given a bad directory path</span>
<span class="o">[</span> ! -d <span class="s2">&quot;</span><span class="nv">$_dir</span><span class="s2">&quot;</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="o">{</span> <span class="nb">echo</span> <span class="s2">&quot;Error: Directory </span><span class="nv">$_dir</span><span class="s2"> not found.&quot;</span><span class="p">;</span> <span class="nb">exit</span> <span class="m">2</span><span class="p">;</span> <span class="o">}</span>

<span class="c1"># Make a blank text file</span>
&gt; min_v.txt

<span class="c1"># Print row names</span>
<span class="nb">printf</span> <span class="s2">&quot;dive_no,min_10V,min_24V&quot;</span> &gt;&gt; min_v.txt

<span class="c1"># Search the log files for minimum voltages of both batteries</span>
<span class="k">for</span> i <span class="k">in</span> <span class="nv">$_dir</span>/p*.log<span class="p">;</span> <span class="k">do</span>

    <span class="nv">num</span><span class="o">=</span><span class="si">${</span><span class="nv">i</span><span class="p">: -8:</span><span class="nv">4</span><span class="si">}</span>
    <span class="nb">printf</span> <span class="s2">&quot;\n</span><span class="nv">$num</span><span class="s2">&quot;</span> &gt;&gt; min_v.txt
    <span class="c1">#awk -F, &#39;$1 == &quot;$10V_AH&quot; {printf &quot;\n&quot; ; printf $2}&#39; $i &gt;&gt; min_v.txt</span>
    awk -F, <span class="s1">&#39;$1 == &quot;$10V_AH&quot; {$2=&quot;,&quot;$2; printf $2}&#39;</span> <span class="nv">$i</span> &gt;&gt; min_v.txt
    awk -F, <span class="s1">&#39;$1 == &quot;$24V_AH&quot; {$2=&quot;,&quot;$2; printf $2}&#39;</span> <span class="nv">$i</span> &gt;&gt; min_v.txt
<span class="k">done</span>

<span class="c1"># Remove rows with less than three values (typically dive 0000)</span>
awk -F , <span class="s1">&#39;NF&gt;=3&#39;</span> min_v.txt &gt;&gt; min_volts.txt
</code></pre></div>

<h3>Scripts shamelessly copied from other, wiser people</h3>
<p><a href="http://matt.might.net/articles/shell-scripts-for-passive-voice-weasel-words-duplicates/">3 shell scripts to improve your writing, or "My Ph.D. advisor rewrote himself in bash."</a></p>
<p>I think these are great, so I've archived a version <a href="../images/might-scripts.zip">here</a>.</p>
<hr>
<p>[1] (https://xkcd.com/285/)</p>
<p>[2] (https://xkcd.com/462)</p>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="https://callumrollo.github.io/tag/linux.html">linux</a>
      <a href="https://callumrollo.github.io/tag/bash.html">bash</a>
      <a href="https://callumrollo.github.io/tag/software.html">software</a>
      <a href="https://callumrollo.github.io/tag/optimise.html">optimise</a>
    </p>
  </div>





</article>

    <footer>
<p>
  &copy;  2022 - This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>
</p>
<p>
Built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> theme
</p><p>
  <a rel="license"
     href="http://creativecommons.org/licenses/by-sa/4.0/"
     target="_blank">
    <img alt="Creative Commons License"
         title="Creative Commons License"
         style="border-width:0"
           src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png"
         width="80"
         height="15"/>
  </a>
</p>    </footer>
  </main>




<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Callum Rollo ",
  "url" : "https://callumrollo.github.io",
  "image": "https://callumrollo.github.io/images/mug.jpg",
  "description": "Science should be open. Software should be free. Borders are kind of rubbish "
}
</script>


</body>
</html>